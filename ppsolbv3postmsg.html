<!DOCTYPE html>
<html lang="en" dir="ltr">
<!--**TEST SITE**-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/PPSOLB/style.css">
</head>
<body>
	<h1>postMessage Method Test Example</h1>
    		<div id="ob-container">
		</div>

</body>
<!-- TEST -->
<footer>
	<script type="text/javascript">
	function ppsOnlineBooking() {
		new OnlineBooking({
			container: "ob-container", 
			id: 222222,
		});
	}
	(function() {
		var xhr = new XMLHttpRequest();
		xhr.open("GET", "https://ob.rushcliff.com/status-check", true);
		xhr.onreadystatechange = function() {
			if(xhr.readyState == 4) {
				if(xhr.status == 200 && xhr.responseText == "live") {
					var script = document.createElement("script");
					script.src = "https://ob.rushcliff.com/js/obv4.js";
					document.head.appendChild(script);
				} else {
					document.getElementById("ob-container").innerHTML = "<p>Our online booking service is currently unavailable. Please call, email or try again later.</p>";
				}
			}
		}
		xhr.send();
	})();
	</script>
	
	<script type="text/javascript">
window.addEventListener('message', (message) => {
  if (message.origin == 'https://ob.rushcliff.com' && message.data == 'iframe-loaded') {
    console.log('message received');
   let pageData = {
      name: 'change',
    };
	  
    let onlineBookingIframe = document.getElementById('ob-container').getElementsByTagName('iframe')[0].contentWindow;
    onlineBookingIframe.postMessage(pageData, 'https://ob.rushcliff.com');
  }
});
</script>
	
</footer>

</html>

